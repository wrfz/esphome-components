name: ESPHome UART Test

on:
  push:
    branches:
      - wokwi
  pull_request:

jobs:
  test-esp:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v3
  
      - name: Set up Node.js and install Wokwi CLI
        run: |
          sudo apt update
          sudo apt install -y npm
          npm install -g @wokwi/cli
  
      - name: Build C++ Project
        run: |
          mkdir build
          cd build
          cmake ..
          make
  
      - name: Run Wokwi Simulation Test
        run: |
          wokwi-cli exec \
            --project=./wokwi-project \
            --command="./build/your-test-executable"